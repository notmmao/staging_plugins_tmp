jQuery(document).ready(function(o){function t(o){return!isNaN(parseFloat(o))&&isFinite(o)}function a(){o(".cart").on("keyup change",".product-addon input, .product-addon textarea",function(){if(o(this).attr("maxlength")>0){var t=o(this).val(),a=o(this).attr("maxlength")-t.length;o(this).next(".chars_remaining").find("span").text(a)}}),o(".cart").find(".addon-custom, .addon-custom-textarea").each(function(){o(this).attr("maxlength")>0&&o(this).after('<small class="chars_remaining"><span>'+o(this).attr("maxlength")+"</span> "+woocommerce_addons_params.i18n_remaining+"</small>")}),o(".cart").on("change",".product-addon input, .product-addon textarea, .product-addon select, input.qty, .mod-quantity-input",function(){var t=o(this).closest(".cart");t.trigger("woocommerce-product-addons-update")}),o("body").on("found_variation",".variations_form",function(t,a){var r=o(this),e=r.find("#product-addons-total");o(a.price_html).find(".amount:last").size()&&(product_price=o(a.price_html).find(".amount:last").text(),product_price=product_price.replace(woocommerce_addons_params.currency_format_thousand_sep,""),product_price=product_price.replace(woocommerce_addons_params.currency_format_decimal_sep,"."),product_price=product_price.replace(/[^0-9\.]/g,""),product_price=parseFloat(product_price),e.data("price",product_price)),r.trigger("woocommerce-product-addons-update")}),o(".cart").bind("woocommerce-product-addons-update",function(){var a=0,d=0,i=!1,s=o(this),_=s.find("#product-addons-total"),m=parseFloat(_.data("price"));o("#role-discount").length&&o("#role-discount").data("value")>0&&(n=parseInt(o("#role-discount").data("value")),c=!0);var p=_.data("type");("variable"==p||"variable-subscription"==p)&&s.find(".single_variation").after(_);var u=parseFloat(s.find(".mod-quantity-input").val());isNaN(u)&&(u=parseFloat(s.find(".qty").val())),u=parseFloat(u),o(".addon").each(function(){if(o(this).data("addon-name")){var t=o(this).data("addon-name");"size"==t.toLowerCase()&&(console.log("Size found!"),r=!0,1==o(this).find("option:selected").data("price-percentage")&&(e=o(this).find("option:selected").data("price"),console.log("Size addon: "+e+"%"),e=parseFloat(e/100*m),console.log("New product price is: "+e)))}}),s.find(".addon").each(function(){var t=0;o(this).is(".addon-custom-price")?t=o(this).val():o(this).is(".addon-input_multiplier")?(isNaN(o(this).val())||""==o(this).val()?(o(this).val(""),o(this).closest("p").find(".addon-alert").show()):(""!=o(this).val()&&o(this).val(Math.ceil(o(this).val())),o(this).closest("p").find(".addon-alert").hide()),t=o(this).data("price")*o(this).val()):o(this).is(".addon-checkbox, .addon-radio")?(o(this).is(":checked")&&(t=o(this).data("price")),o(this).data("price-percentage")&&(i=!0)):o(this).is(".addon-select")?(o(this).val()&&(t=o(this).find("option:selected").data("price")),o(this).find("option:selected").data("price-percentage")&&(i=!0)):o(this).val()&&(t=o(this).data("price")),t=parseFloat(t);var r="";if(o(this).data("addon-name")&&(r=o(this).data("addon-name")),"MAILING SERVICES / SORTING FEES"==r)return d+=t,t=0,void(a+=t);if(i){var c=e;("size"==r.toLowerCase()||"standard sizes"==r.toLowerCase())&&(c=0),0!=t&&(t=parseFloat(t/100*(m+c)),console.log("Option: "+o(this).data("addon-name")+",  "+t))}isNaN(t)&&(t=0),a+=t});var l=accounting.formatMoney(a,{symbol:woocommerce_addons_params.currency_format_symbol,decimal:woocommerce_addons_params.currency_format_decimal_sep,thousand:woocommerce_addons_params.currency_format_thousand_sep,precision:woocommerce_addons_params.currency_format_num_decimals,format:woocommerce_addons_params.currency_format}),f=0,h=!1;if(product_unit_price=parseFloat(m),product_unit_price_to_format=product_unit_price+a,product_total_price=parseFloat((m+a)*u),(!t(product_unit_price_to_format)||product_unit_price_to_format<0)&&(product_unit_price_to_format=0),console.log("Unit price before round: "+product_unit_price_to_format),product_unit_price_to_format=Math.round(100*product_unit_price_to_format)/100,product_total_price_to_format=product_unit_price_to_format*u,discountRules.length){for(var g in discountRules[0].rules){var y=discountRules[0].rules[g];if(u>=y.from&&u<=y.to){f=y.amount,h=y.type;break}}if(f){if(console.log("Discount found:"),console.log("	"+f+", "+h),console.log("	Price before: "+product_total_price_to_format),"percentage_discount"==h){product_total_price_to_format=Math.round(product_unit_price_to_format/100*(100-f)*100)/100*u;var v="Including "+f+"% quantity discount"}else if("price_discount"==h){product_total_price_to_format=(product_unit_price_to_format-f)*u;var v="Including $"+f+" quantity discount"}else{product_total_price_to_format=f;var v="Including quantity discount"}console.log("	Price after: "+product_total_price_to_format)}}product_unit_price_to_format+=d/u,product_total_price_to_format+=d;var w=accounting.formatMoney(product_unit_price_to_format,{symbol:woocommerce_addons_params.currency_format_symbol,decimal:woocommerce_addons_params.currency_format_decimal_sep,thousand:woocommerce_addons_params.currency_format_thousand_sep,precision:woocommerce_addons_params.currency_format_num_decimals,format:woocommerce_addons_params.currency_format}),b=0;if(c){var x=product_unit_price_to_format*(1-n/100);x=Math.round(100*x)/100,x*=u;var b=accounting.formatMoney(x,{symbol:woocommerce_addons_params.currency_format_symbol,decimal:woocommerce_addons_params.currency_format_decimal_sep,thousand:woocommerce_addons_params.currency_format_thousand_sep,precision:woocommerce_addons_params.currency_format_num_decimals,format:woocommerce_addons_params.currency_format})}var F=accounting.formatMoney(product_total_price_to_format,{symbol:woocommerce_addons_params.currency_format_symbol,decimal:woocommerce_addons_params.currency_format_decimal_sep,thousand:woocommerce_addons_params.currency_format_thousand_sep,precision:woocommerce_addons_params.currency_format_num_decimals,format:woocommerce_addons_params.currency_format});if(o(".single_variation_wrap .subscription-details").length){var N=o(".single_variation_wrap .subscription-details").clone().wrap("<p>").parent().html();l+=N,w&&(w+=N)}html='<dl class="product-addon-totals"><dt>'+woocommerce_addons_params.i18n_addon_total+'</dt><dd><strong><span class="amount">'+l+"</span></strong></dd>",html=html+'<dt>Unit price: </dt><dd><strong><span class="amount">'+w+"</span></strong></dd>",c?(html=html+'<dt>Grand total: </dt><dd><del><strong><span class="amount">'+F+"</span></strong></del></dd>",html=html+'<dt>&nbsp;</dt><dd><strong><span class="amount" style="font-size: 1.1em;color: rgb(234, 109, 60);margin-left: -86px;">Your price: '+b+"</span></strong></dd>"):html=html+'<dt>Grand total: </dt><dd><strong><span class="amount">'+F+"</span></strong></dd>",f>0&&(html=html+'<dt style="font-size: 0.8em; color:#888; -moz-hyphens: none; margin-top: -18px;">'+v+"</dt><dd></dd>"),html+="</dl>",_.html(html),o("body").trigger("updated_addons"),console.log(""),console.log("-----------------------------------------------")}),o(".cart").find(".addon-custom, .addon-custom-textarea, .product-addon input, .product-addon textarea, .product-addon select, .mod-quantity-input").change()}var r=!1,e=0,c=!1,n=0;a(),o(".variations_form .product-addon").closest(".cart").find(".variations select").change(),o("body").on("quick-view-displayed",function(){a()})});
